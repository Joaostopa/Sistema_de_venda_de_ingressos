{{> partials/header}}

<h1>Histórico de Compras</h1>

<ul id="purchase-list"></ul>

<script>
document.addEventListener("DOMContentLoaded", async function () {
    const token = localStorage.getItem("token");
    if (!token) {
        alert("Você precisa estar logado para ver o histórico de compras.");
        window.location.href = "/login";
        return;
    }

    const response = await fetch("/api/purchases", {
        headers: { "Authorization": `Bearer ${token}` }
    });

    const purchases = await response.json();

    const purchaseList = document.getElementById("purchase-list");
    if (purchases.length > 0) {
        purchases.forEach(purchase => {
            const item = document.createElement("li");
            item.innerHTML = `
                <strong>${purchase.ticketType.name}</strong> - ${purchase.quantity} ingresso(s) - ${purchase.purchaseDate}
                <a href="/purchases/${purchase._id}">Ver detalhes</a>
            `;
            purchaseList.appendChild(item);
        });
    } else {
        purchaseList.innerHTML = "<p>Você ainda não comprou ingressos.</p>";
    }
});
</script>

{{> partials/footer}}
