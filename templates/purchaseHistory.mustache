{{> partials/header}}

<h1>Hist√≥rico de Compras</h1>

<ul id="purchase-list"></ul>

<script>
document.addEventListener("DOMContentLoaded", async function () {
    const token = localStorage.getItem("token");

    if (!token) {
        alert("Voc√™ precisa estar logado para ver o hist√≥rico de compras.");
        window.location.href = "/login";
        return;
    }

    console.log("üîπ Enviando requisi√ß√£o com token:", token);

    try {
        const response = await fetch("/api/purchases", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
            }
        });

        console.log("üîπ Status da resposta:", response.status);

        if (!response.ok) {
            throw new Error(`Erro ao carregar hist√≥rico de compras. C√≥digo: ${response.status}`);
        }

        const purchases = await response.json();
        console.log("üîπ Compras carregadas:", purchases);

        const purchaseList = document.getElementById("purchase-list");
        purchaseList.innerHTML = "";

        if (purchases.length > 0) {
            purchases.forEach(purchase => {
                const item = document.createElement("li");
                item.innerHTML = `
                    <strong>${purchase.ticketType.name}</strong> - ${purchase.quantity} ingresso(s) - ${new Date(purchase.purchaseDate).toLocaleDateString("pt-BR")}
                `;
                purchaseList.appendChild(item);
            });
        } else {
            purchaseList.innerHTML = "<p>Voc√™ ainda n√£o comprou ingressos.</p>";
        }
    } catch (error) {
        console.error("‚ùå Erro ao carregar compras:", error);
        alert("Erro ao carregar hist√≥rico de compras.");
    }
});
</script>

{{> partials/footer}}
